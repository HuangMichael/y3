var FormWizard = function () {
    return {
        init: function () {
            if (!jQuery().bootstrapWizard) {
                return;
            }
            var wizform = $('#wizForm');

            var selectCarts = "";
            var alert_success = $('.alert-success', wizform);
            var alert_error = $('.alert-danger', wizform);
            $('#formWizard').bootstrapWizard({
                'nextSelector': '.nextBtn',
                'previousSelector': '.prevBtn',
                onNext: function (tab, navigation, index) {
                    /*  alert_success.hide();
                     alert_error.hide();*/
                    var total = navigation.find('li').length;
                    var current = index + 1;
                    if (current == 1) {
                        alert("验证选中记录");
                    } else if (current == 2) {
                        if (!validateSelect()) {
                            // showMessageBoxCenter("danger", "center","请选择报修信息！");
                            showMessageBoxCenter("danger", "center", "请选择报修信息！");
                            return false;
                        } else {
                            selectCarts = getSelectID().join(",");
                            LoadOrderDescList(selectCarts);
                        }
                        $('#formWizard').find('.prevBtn').show();
                        $('#formWizard').find('.nextBtn').show();
                        $('#formWizard').find('.submitBtn').hide();
                    } else if (current == 3) {
                        if (!checkOrderDesc()) {
                            // showMessageBox("danger", "请输入维修描述信息！");
                            showMessageBoxCenter("danger", "center", "请输入维修描述信息！");
                            return false;
                        } else {
                            //将描述更新到列表中
                            getAllOrderDesc();
                            loadCommitPage(selectCarts);
                        }
                        $('#formWizard').find('.prevBtn').show();
                        $('#formWizard').find('.nextBtn').hide();
                        $('#formWizard').find('.submitBtn').show();
                    }


                    $('.stepHeader', $('#formWizard')).text('第 ' + (index + 1) + ' 步共 ' + total + "步");
                    jQuery('li', $('#formWizard')).removeClass("done");
                    var li_list = navigation.find('li');
                    for (var i = 0; i < index; i++) {
                        jQuery(li_list[i]).addClass("done");
                    }
                },
                onPrevious: function (tab, navigation, index) {
                    alert_success.hide();
                    alert_error.hide();
                    var total = navigation.find('li').length;
                    var current = index + 1;
                    $('.stepHeader', $('#formWizard')).text('第 ' + (index + 1) + ' 步共 ' + total + "步");
                    jQuery('li', $('#formWizard')).removeClass("done");
                    var li_list = navigation.find('li');
                    for (var i = 0; i < index; i++) {
                        jQuery(li_list[i]).addClass("done");
                    }

                    if (current == 1) {
                        $('#formWizard').find('.prevBtn').hide();
                        $('#formWizard').find('.nextBtn').show();
                        $('#formWizard').find('.submitBtn').hide();
                    }
                    else if (current == 2) {
                        $('#formWizard').find('.prevBtn').show();
                        $('#formWizard').find('.nextBtn').show();
                        $('#formWizard').find('.submitBtn').hide();
                    } else if (current == 3) {
                        $('#formWizard').find('.prevBtn').show();
                        $('#formWizard').find('.nextBtn').hide();
                        $('#formWizard').find('.submitBtn').show();
                    }


                },
                onTabClick: function (tab, navigation, index) {
                    return false;
                },
                onTabShow: function (tab, navigation, index) {
                    var total = navigation.find('li').length;
                    var current = index + 1;
                    var $percent = (current / total) * 100;
                    $('#formWizard').find('.progress-bar').css({
                        width: $percent + '%'
                    });
                }
            });

            $('#formWizard').find('.prevBtn').hide();
            $('#formWizard .submitBtn').click(function () {
                var url = "/workOrderReport/generateReport";
                var ids = selectCarts;
                $.post(url, {ids: ids}, function (data) {
                    showMessageBox("info", "报修单已生成！");

                    //生成之后清空内容显示成功

                    $('#formWizard').find('.prevBtn').hide();
                    $('#formWizard').find('.nextBtn').hide();
                    $('#formWizard').find('.submitBtn').hide();
                    //显示报修单已经提交成功
                    var x = '<div align="center"><img src="/img/success.png" height="40px" width="40px"><h2 style="font-size:large;color:green;align-content: center">报修单提交成功!</h2></div>';
                    $("#confirm").empty().append(x);
                })
            }).hide();
        }
    };
}();


function getSelectID() {
    var chk_value = [];
    $('input[name^="cartCheck"]:checked').each(function () {

        if ($(this).val()) {
            chk_value.push($(this).val());
        }

    });
    return chk_value;
}


function validateSelect() {

    return getSelectID().length != 0;
}


function checkOrderDesc() {
    var result = true;
    $('input[id^="orderDesc"]').each(function () {
        if (!$(this).val()) {
            result = false;
            return result;
        }

    });
    return result;
}


function getAllCheckboxID() {
    var chk_value = [];
    $('input[name^="cartCheck"]').each(function () {
        chk_value.push($(this).val());
    });
    return chk_value
}


function removeTr() {
    var unselecat = [11, 12];
    for (var x in unselecat) {
        if (unselecat[x]) {
            console.log("unselect[x]------------" + unselecat[x]);
        }

    }
}


/**
 *
 * @param ids
 * @constructor
 */
function LoadOrderDescList(ids) {
    var url = "/workOrderReportCart/loadOrderDesc";
    $("#payment").load(url, {ids, ids});

}


/**
 *  获取用户输入的描述
 */
function getAllOrderDesc() {

    var array = [];
    $("input[id^='orderDesc']").each(function () {
        var eId = $(this).attr("id");
        var id = eId.substr(9, eId.length);
        var orderDesc = $(this).val();
        var object = {
            id: id,
            orderDesc: orderDesc
        }
        array.push(object);
        var url = "/workOrderReportCart/updateOrderDesc";
        $.post(url, {
            id: id,
            orderDesc: orderDesc
        })
    });


}


/**
 *
 * @param ids
 * @constructor
 */
function loadCommitPage(ids) {
    var url = "/workOrderReportCart/loadCommitPage";
    $("#confirm").load(url, {ids, ids});

}